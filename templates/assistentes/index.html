{% extends "layout/base.html" %}

{% block main %}
<div class="container-fluid py-4">
    {% if assistentes %}
    <div class="row g-4">
        {% for assistente in assistentes %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card shadow-sm h-100 border-primary border-2">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ assistente.nome }}</h5>
                    <p class="card-text text-muted mb-2">
                        <i>{{ assistente.descricao[0:100] or 'Sem descrição.' }}</i>
                    </p>
                    <div class="mt-auto d-flex gap-2">
                        <a href="{{ url_for('assistentes_executar', id=assistente.id) }}" class="btn btn-block btn-outline-primary">
                            <i class="fas fa-play"></i> Executar
                        </a>
                        <a href="{{ url_for('assistentes_editar', id=assistente.id) }}" class="btn btn-outline-warning">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button type="button" class="btn btn-outline-danger btn-excluir-assistente" data-id="{{ assistente.id }}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info text-center">Nenhum assistente encontrado.</div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.querySelectorAll('.btn-excluir-assistente').forEach(btn => {
    btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        Swal.fire({
            title: 'Tem certeza?',
            text: 'Esta ação não poderá ser desfeita!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Sim, excluir!',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`/assistentes/${id}/excluir`, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                }).then(resp => {
                    if (resp.redirected) {
                        window.location.href = resp.url;
                    } else {
                        window.location.reload();
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}