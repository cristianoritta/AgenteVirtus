<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultado - AgenteVirtus</title>
    <link rel="stylesheet" href="/static/css/agentes_canva.css">
    <style>
        .resultado-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .resultado-final {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .resposta-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .resposta-header {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        .resposta-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .download-link {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
        }
        .download-link:hover {
            background: #0056b3;
            color: white;
        }
        .voltar-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
            margin-top: 20px;
        }
        .voltar-btn:hover {
            background: #545b62;
            color: white;
        }
    </style>
</head>
<body>
    <div class="resultado-container">
        <h1>Resultado do Processamento</h1>
        
        <div class="resultado-final">
            <h2>Resultado Final</h2>
            <div class="resposta-content">{{ resultado }}</div>
        </div>

        <h2>Detalhes do Processamento</h2>
        {% for resposta in respostas %}
        <div class="resposta-item">
            <div class="resposta-header">
                {% if resposta.node.type == 'agent' %}
                    ü§ñ Agente: {{ resposta.node.config.role if resposta.node.config.role else 'Agente' }}
                {% elif resposta.node.type == 'task' %}
                    ‚öôÔ∏è Tarefa: {{ resposta.node.config.description if resposta.node.config.description else 'Tarefa' }}
                {% elif resposta.node.type == 'guardrail' %}
                    üõ°Ô∏è Guardrail: {{ resposta.node.config.name if resposta.node.config.name else 'Guardrail' }}
                {% elif resposta.node.type == 'formatoSaida' %}
                    üìÑ Formato de Sa√≠da: {{ resposta.node.config.type if resposta.node.config.type else 'Formato' }}
                {% else %}
                    üìã {{ resposta.node.type|title }}
                {% endif %}
            </div>
            <div class="resposta-content">{{ resposta.resposta }}</div>
            
            {% if resposta.node.type == 'formatoSaida' and resposta.arquivo_download %}
            <a href="#" onclick="downloadArquivo('{{ resposta.node.id }}')" class="download-link">
                üì• Download do Arquivo
            </a>
            {% endif %}
        </div>
        {% endfor %}

        <a href="/agentesinteligentes/equipes" class="voltar-btn">‚Üê Voltar para Equipes</a>
    </div>

    <script>
        function downloadArquivo(nodeId) {
            // Obter o formato do n√≥ a partir dos dados da p√°gina
            const nodeData = getNodeData(nodeId);
            if (nodeData && nodeData.formato) {
                const url = `/agentesinteligentes/download_arquivo/{{ equipe.id }}/${nodeId}/${nodeData.formato}`;
                window.open(url, '_blank');
            } else {
                alert('Formato n√£o encontrado para este n√≥!');
            }
        }
        
        function getNodeData(nodeId) {
            // Buscar os dados do n√≥ na p√°gina
            const nodeElements = document.querySelectorAll('.resposta-item');
            for (let element of nodeElements) {
                const header = element.querySelector('.resposta-header');
                if (header && header.textContent.includes('Formato de Sa√≠da')) {
                    // Extrair o formato do texto do header
                    const formatoMatch = header.textContent.match(/Formato de Sa√≠da: (.+)/);
                    if (formatoMatch) {
                        return { formato: formatoMatch[1].toLowerCase() };
                    }
                }
            }
            return null;
        }
    </script>
</body>
</html>